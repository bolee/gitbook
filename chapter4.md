# 第五章 数据缓存

缓存包括内存和文件缓存，大部分项目都会继承图片框架和对应的缓存框架，对于底层部分已经做好封装，常见的`SDWebImage`、`YYKit`等都会有图片缓存。

## 一、图片缓存

1. 第三方图片框架，都集成了缓存处理模块，在特殊场景可能需要自定义下载处理，可以利用框架的缓存模块进行扩展。针对图片下载必须进入后台一队列模式，防止占用过多资源，建议提供对外的缓存大小统计和清除操作。

2. 磁盘缓存放到`Cache`目录，如果系统空间不足会自动清理缓存和临时目录文件，保证系统的稳定性。

3. 对图片缓存需要限制大小，不能无休止占用磁盘空间，设计对应自动清除缓存机制(如`LRU`)，保证在可控范围内。

4. 大部分图片缓存只有当前界面使用时候才需要保存到内存缓存`NSCache`，内存相对磁盘空间更小、更昂贵，尽量控制好内存缓存大小防止过大被系统杀掉。

## 二、数据缓存

1. 少量的参数数据可以直接保存到`NSUserDefault`，不建议写入过多数据，再同步时候回block住，保证写入完成。

2. 缓存数据可以保存到数据库(`sqlite`)和文件，对外提供统计信息和清除操作，需要添加自动计算和大小控制，除一些必要的数据可以保存在`Document`之外都必须保存在`Cache`或`Temp`目录。

3. 缓存文件操作注意并发问题，读写问题可能导致数据错乱或系统崩溃。

4. 大部分情况不建议将数据缓存到内存，一般都是解析到`model`供前台使用。

5. 不要将数据缓存到`NSDictionary`和`NSArray`，使用`NSCache`替代。

## 三、临时缓存

如有一些临时缓存可以放到内存管理器使用，统一控制大小、清除操作，如果需要可以保存到临时目录`temp`，在APP重启时候，上一次的数据都会被清除。
